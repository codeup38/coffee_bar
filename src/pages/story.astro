---
import Accordion from "../components/Accordion.astro";
import Layout from "../components/Layout.astro";
import beans from "../data/beans.json";
import site from "../data/site.json";

const beanIds = beans.map((bean) => bean.id);
---

<Layout title="이야기 · coffee bar" description="왜 이 커피바를 열었는지">
  <section class="sticker-card">
    <p class="sticker-chip inline-flex">STORY</p>
    <h1 class="mt-3 text-3xl font-bold text-roast">왜 커피를 내릴까</h1>

    <div class="mt-4 space-y-4 text-sm text-ink/90">
      {site.story.intro.map((paragraph) => <p>{paragraph}</p>)}
    </div>

    <div class="mt-5 space-y-3">
      <Accordion title="더 읽기: 제가 커피를 좋아하는 이유">
        <div class="space-y-3">
          {site.story.why_i_like_coffee.map((paragraph) => <p>{paragraph}</p>)}
        </div>
      </Accordion>

      <Accordion title="더 읽기: 드립 커피가 뭔가요?">
        <div class="space-y-3">
          {site.story.what_is_drip.map((paragraph) => <p>{paragraph}</p>)}
        </div>
      </Accordion>
    </div>

    <div class="mt-6 space-y-2 text-sm text-ink/90">
      <p>{site.story.closing}</p>
      <p class="font-semibold text-roast/80">{site.story.signature}</p>
    </div>

    <div class="mt-6 text-center">
      <a
        id="ordered-bean-link"
        href="/beans"
        class="text-sm font-bold text-roast underline decoration-roast/40 underline-offset-4"
      >
        원두 구경하기
      </a>
    </div>
  </section>

  <script is:inline define:vars={{ beanIds }}>
    const validBeanIds = new Set(beanIds);
    const params = new URLSearchParams(window.location.search);
    const beanId = params.get("bean");

    if (beanId && validBeanIds.has(beanId)) {
      const orderedBeanLink = document.getElementById("ordered-bean-link");
      if (orderedBeanLink) {
        orderedBeanLink.setAttribute("href", `/beans/${beanId}?reading=1`);
        orderedBeanLink.textContent = "STEP 2: 주문한 원두 알아보기";
      }
    }
  </script>
</Layout>
