---
import Accordion from "../components/Accordion.astro";
import Layout from "../components/Layout.astro";
import beans from "../data/beans.json";
import site from "../data/site.json";

const beanIds = beans.map((bean) => bean.id);
---

<Layout title="이야기 · coffee bar" description="왜 이 커피바를 열었는지">
  <section class="sticker-card">
    <p class="sticker-chip inline-flex">STORY</p>
    <h1 class="mt-3 text-3xl font-bold text-roast">왜 커피를 내릴까</h1>

    <div class="mt-4 space-y-4 text-sm text-ink/90">
      {site.story.intro.map((paragraph) => <p>{paragraph}</p>)}
    </div>

    <div class="mt-5 space-y-3">
      <Accordion title="더 읽기: 제가 커피를 좋아하는 이유">
        <div class="space-y-3">
          {site.story.why_i_like_coffee.map((paragraph) => <p>{paragraph}</p>)}
        </div>
      </Accordion>

      <Accordion title="더 읽기: 드립 커피가 뭔가요?">
        <div class="space-y-3">
          {site.story.what_is_drip.map((paragraph) => <p>{paragraph}</p>)}
        </div>
      </Accordion>
    </div>

    <div class="mt-6 space-y-2 text-sm text-ink/90">
      <p>{site.story.closing}</p>
      <p class="font-semibold text-roast/80">{site.story.signature}</p>
    </div>

    <div class="mt-6 rounded-xl bg-paper px-4 py-3">
      <p class="text-sm font-bold text-roast">커피가 나왔다면</p>
      <p class="mt-1 text-xs text-ink/70">주문한 원두의 맛 포인트와 배경을 읽으면서 마셔 보세요.</p>
    </div>

    <div class="mt-4 grid gap-2 sm:grid-cols-2">
      <a
        id="ordered-bean-link"
        href="/beans"
        class="touch-target inline-flex items-center justify-center rounded-xl bg-roast px-4 py-2.5 text-sm font-bold text-paper"
      >
        내 원두 이야기 읽기
      </a>
      <a
        href="/beans"
        class="touch-target inline-flex items-center justify-center rounded-xl border border-roast/30 bg-paper px-4 py-2.5 text-sm font-bold text-roast"
      >
        다른 원두 구경하기
      </a>
    </div>
  </section>

  <script is:inline>
    const validBeanIds = new Set({JSON.stringify(beanIds)});
    const params = new URLSearchParams(window.location.search);
    const beanId = params.get("bean");

    if (beanId && validBeanIds.has(beanId)) {
      const orderedBeanLink = document.getElementById("ordered-bean-link");
      if (orderedBeanLink) {
        orderedBeanLink.setAttribute("href", `/beans/${beanId}?reading=1`);
      }
    }
  </script>
</Layout>
