---
import Layout from "../components/Layout.astro";
import beans from "../data/beans.json";

const beanIds = beans.map((bean) => bean.id);
---

<Layout title="주문 완료 · coffee bar" description="주문이 접수되었습니다">
  <section class="sticker-card text-center">
    <p class="sticker-chip inline-flex">ORDER RECEIVED</p>
    <h1 class="mt-3 text-3xl font-bold text-roast">접수됐습니다!</h1>
    <p class="mt-3 text-sm text-ink/85">
      정성껏 내리다 보니 조금 시간이 걸립니다.<br/>
      기다리는 동안 읽을 거리를 준비해 두었습니다.
    </p>

    <div class="mt-6 space-y-4 text-left">
      <!-- STEP 1 -->
      <div class="rounded-xl border border-roast/15 bg-paper p-4">
        <p class="text-xs font-bold tracking-wide text-roast/60">STEP 1</p>
        <p class="mt-1 font-bold text-roast">기다리면서 커피 이야기 읽기</p>
        <p class="mt-1 text-xs text-ink/70">왜 이 커피바를 열었는지, 드립 커피가 뭔지 소개합니다.</p>
        <a
          id="story-cta"
          href="/story"
          class="touch-target mt-3 inline-flex w-full items-center justify-center rounded-xl bg-roast px-4 py-3 text-sm font-bold text-paper"
        >
          커피 이야기 읽기
        </a>
      </div>

      <!-- STEP 2 -->
      <div class="rounded-xl border border-roast/15 bg-paper p-4">
        <p class="text-xs font-bold tracking-wide text-roast/60">STEP 2</p>
        <p class="mt-1 font-bold text-roast">커피 받으면, 원두 해설 읽기</p>
        <p class="mt-1 text-xs text-ink/70">내가 주문한 원두의 맛 포인트와 배경을 알아봅니다.</p>
        <a
          id="ordered-bean-cta"
          href="/beans"
          class="touch-target mt-3 inline-flex w-full items-center justify-center rounded-xl border border-roast/30 bg-paper px-4 py-3 text-sm font-bold text-roast"
        >
          주문한 원두 알아보기
        </a>
      </div>

      <div class="text-center">
        <a href="/beans" class="inline-flex items-center justify-center pt-1 text-xs font-semibold text-roast/80 underline decoration-roast/30 underline-offset-4">
          다른 원두 구경하기
        </a>
      </div>
    </div>
  </section>

  <script is:inline>
    const validBeanIds = new Set({JSON.stringify(beanIds)});
    const params = new URLSearchParams(window.location.search);
    const beanId = params.get("bean");

    if (beanId && validBeanIds.has(beanId)) {
      const storyCta = document.getElementById("story-cta");
      const orderedBeanCta = document.getElementById("ordered-bean-cta");

      if (storyCta) {
        storyCta.setAttribute("href", `/story?bean=${beanId}`);
      }

      if (orderedBeanCta) {
        orderedBeanCta.setAttribute("href", `/beans/${beanId}?reading=1`);
      }
    }
  </script>
</Layout>
