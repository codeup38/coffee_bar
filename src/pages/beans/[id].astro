---
import Accordion from "../../components/Accordion.astro";
import Layout from "../../components/Layout.astro";
import OrderForm from "../../components/OrderForm.astro";
import beans from "../../data/beans.json";

export function getStaticPaths() {
  return beans.map((bean) => ({
    params: { id: bean.id },
    props: { bean }
  }));
}

const { bean } = Astro.props;

const profileItems = [
  { label: "산미", value: bean.profile.acidity },
  { label: "단맛", value: bean.profile.sweetness },
  { label: "바디", value: bean.profile.body }
];
---

<Layout title={`${bean.name} | Family Coffee Bar`} description={bean.one_liner}>
  <section class="sticker-card">
    <p class="sticker-chip inline-flex">Bean Detail</p>
    <h1 class="mt-3 text-3xl font-bold text-roast sm:text-4xl">{bean.name}</h1>
    <p class="mt-2 text-base text-ink/90">{bean.one_liner}</p>

    <ul class="mt-3 flex flex-wrap gap-2">
      {bean.notes.map((note) => <li class="sticker-chip">{note}</li>)}
    </ul>

    <dl class="mt-4 space-y-2">
      {
        profileItems.map((item) => (
          <div class="grid grid-cols-[45px_1fr_40px] items-center gap-2 text-sm">
            <dt class="font-bold text-roast">{item.label}</dt>
            <dd class="taste-meter">
              {Array.from({ length: 5 }).map((_, index) => <span class={index < item.value ? "is-active" : ""} />)}
            </dd>
            <dd class="text-right text-xs text-ink/70">{item.value}/5</dd>
          </div>
        ))
      }
    </dl>

    <a
      href="#order-section"
      class="touch-target mt-5 inline-flex items-center justify-center rounded-xl bg-roast px-5 py-2.5 text-sm font-bold text-paper"
    >
      주문하기
    </a>
  </section>

  <section class="sticker-card mt-6">
    <h2 class="text-2xl font-bold text-roast">원두 소개</h2>
    <p class="mt-3 text-sm text-ink/90">{bean.intro}</p>
  </section>

  <section class="mt-6 space-y-3">
    <Accordion title="추출 의도" summary="바리스타가 어떤 느낌으로 내리는지">
      <p>{bean.brew_intent}</p>
    </Accordion>

    <Accordion title="이렇게 생각하며 마시면 더 맛있어요" summary="한 잔을 더 재미있게 즐기는 방법" open={true}>
      <p>{bean.enjoy_tip}</p>
    </Accordion>

    {
      bean.geek_note && (
        <Accordion title="더보기: 레시피 메모" summary="덕후용 메모">
          <p>{bean.geek_note}</p>
        </Accordion>
      )
    }
  </section>

  <OrderForm bean={bean} pagePath={`/beans/${bean.id}`} />

  <div class="mt-6 text-center">
    <a href="/beans" class="text-sm font-bold text-roast underline decoration-roast/40 underline-offset-4">원두 목록으로 돌아가기</a>
  </div>
</Layout>
